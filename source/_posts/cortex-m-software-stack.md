---
title: 6. SW Stackê³¼ ëª¨ë“ˆí™”
date: 2025-06-23
categories:
  - Cortex-M
  - ARM
  - Embedded
tags:
  - SW Stack
  - ëª¨ë“ˆí™”
  - í´ë”ë¶„ë¦¬
  - ê³„ì¸µêµ¬ì¡°
layout: post
---

# SW Stackê³¼ ëª¨ë“ˆí™”

ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ARM ë ˆí¬ì§€í† ë¦¬ì—ì„œ ì‹¤ì œë¡œ ë‹¤ë£¬ SW Stack ê°œë…ê³¼ í´ë” ë¶„ë¦¬ë¥¼ í†µí•œ ëª¨ë“ˆí™” ë°©ë²•ì„ ì•Œì•„ë³¸ë‹¤.

## ðŸ“ í´ë” ë¶„ë¦¬ì˜ í•„ìš”ì„±

### GPIO ê´€ë ¨ ê¸°ëŠ¥ ë¶„ë¦¬

ê¸°ì¡´ì— main.cì— ëª¨ë“  ì½”ë“œê°€ ì§‘ì¤‘ë˜ì–´ ìžˆë˜ ê²ƒì„ GPIO ê´€ë ¨ëœ ê¸°ëŠ¥ë“¤ì„ ë”°ë¡œ ë¶„ë¦¬í•œë‹¤.

**ë¶„ë¦¬ ì „ ë¬¸ì œì :**
- ëª¨ë“  ì½”ë“œê°€ main.cì— ì§‘ì¤‘
- ê¸°ëŠ¥ë³„ êµ¬ë¶„ì´ ì–´ë ¤ì›€
- ìž¬ì‚¬ìš©ì„± ë‚®ìŒ
- ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

**ë¶„ë¦¬ í›„ ìž¥ì :**
- ê¸°ëŠ¥ë³„ ëª…í™•í•œ êµ¬ë¶„
- ì½”ë“œ ìž¬ì‚¬ìš© ê°€ëŠ¥
- ìœ ì§€ë³´ìˆ˜ ìš©ì´
- í˜‘ì—… íš¨ìœ¨ì„± í–¥ìƒ

## ðŸ—ï¸ SW Stack ê°œë…

### SWì˜ íë¦„ê³¼ ê³„ì¸µ êµ¬ì¡°

SWì˜ íë¦„ì€ ìœ„ì—ì„œ ì•„ëž˜ë¡œ ì§„í–‰ëœë‹¤. SWê°€ HWë¥¼ ì œì–´í•˜ëŠ” ê³„ì¸µì  êµ¬ì¡°ë‹¤.

![SW Stack êµ¬ì¡°](https://raw.githubusercontent.com/goeun-oh/ARM/main/0619/0.GPIO_BTN_%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0.md%7B237EF5FA-4218-4683-8031-73F87911D2AB%7D.png)

### SW Stack êµ¬ì¡°ë„

```
+------------------------+
|         SW            |
|  +-----------------+  |
|  |     main        |  |  â† System ì´ˆê¸°í™”, Application ì‹¤í–‰
|  |  +-----------+  |  |
|  |  |Application|  |  |  â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
|  |  +-----------+  |  |
|  |  |  Driver   |  |  |  â† í•˜ë“œì›¨ì–´ ì¶”ìƒí™” ê³„ì¸µ
|  |  +-----------+  |  |
|  |  | Interface |  |  |  â† í•˜ë“œì›¨ì–´ ì§ì ‘ ì œì–´
|  |  +-----------+  |  |
|  +-----------------+  |
+------------------------+
+------------------------+
|         HW            |  â† ì‹¤ì œ í•˜ë“œì›¨ì–´
+------------------------+
```

### ê° ê³„ì¸µì˜ ì—­í• 

**main ê³„ì¸µ:**
- `system` ì´ˆê¸°í™”
- `application` ì‹¤í–‰ ê¸°ëŠ¥ ì™¸ì—ëŠ” ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤

**Application ê³„ì¸µ:**
- ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ êµ¬í˜„
- ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì²˜ë¦¬

**Driver ê³„ì¸µ:**
- í•˜ë“œì›¨ì–´ ì¶”ìƒí™”
- ìž¬ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ ì œê³µ

**Interface ê³„ì¸µ:**
- í•˜ë“œì›¨ì–´ ì§ì ‘ ì œì–´
- ë ˆì§€ìŠ¤í„° ìˆ˜ì¤€ ì ‘ê·¼

## ðŸš« ìž˜ëª»ëœ ì ‘ê·¼ ë°©ì‹

### Applicationì—ì„œ Interface ì§ì ‘ ì ‘ê·¼ ë¬¸ì œ

Applicationì—ì„œ ë°”ë¡œ GPIO(Interface)ë¡œ ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ì§€ì–‘í•´ì•¼ í•œë‹¤.

**ë¬¸ì œì :**
- GPIOëŠ” í•˜ë“œì›¨ì–´ì— ê°€ê¹Œìš´ ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì—, Applicationì—ì„œ ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•Šë‹¤
- ë‹¨ì§€ Driverë§Œ ìˆ˜ì •í•˜ë©´ ë˜ëŠ” ê²ƒì´ Interfaceê¹Œì§€ ìˆ˜ì •í•´ì•¼ ë˜ì–´ ë²ˆê±°ë¡œì›Œì§„ë‹¤

### ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ì˜ˆì‹œ

ì¸í„°ë„·ì˜ 'software stack'ì—ì„œë„ ë™ì¼í•œ ì›ì¹™ì´ ì ìš©ëœë‹¤.

![ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ì˜ˆì‹œ](https://raw.githubusercontent.com/goeun-oh/ARM/main/0619/0.GPIO_BTN_%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0.md%7BC210C9A6-E664-471B-8447-DBD93432D92B%7D.png)

Applicationì—ì„œ ë°”ë¡œ MACì´ë‚˜ PHYì— ì ‘ê·¼í•˜ì§€ ì•ŠëŠ”ë‹¤.

## ðŸ’¡ ì˜¬ë°”ë¥¸ ì„¤ê³„ ì›ì¹™

### ì¸ì ‘í•œ Layerë¥¼ í†µí•œ í†µì‹ 

**í•µì‹¬ ì›ì¹™:** Applicationì—ì„œ ì¸ì ‘í•œ LayerëŠ” Driverë‹¤.

**ì¸ì ‘í•œ Layerë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ì†¡ìˆ˜ì‹ í•´ì•¼ í•œë‹¤**

ì´ë ‡ê²Œ ë§Œë“¤ì–´ì•¼ ìž¬ì‚¬ìš©ì„±ì´ ì¢‹ë‹¤.

## ðŸ”§ ì‹¤ì œ ì ìš©: GPIO ë²„íŠ¼ ì¶”ê°€

### ê¸°ì¡´ ë¬¸ì œìƒí™©

ê¸°ì¡´ì˜ LED Shifter ê¸°ëŠ¥ì—ì„œ BTN ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ BTNì„ ëˆ„ë¥´ë©´ LEDê°€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ SHIFT í•˜ë„ë¡ í•˜ë ¤ê³  í–ˆë‹¤.

í•˜ì§€ë§Œ ê¸°ì¡´ì— êµ¬í˜„í–ˆë˜ ê²ƒì€ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ìžˆì„ ë•Œ LEDê°€ ë©ˆì¶”ëŠ” ë¬¸ì œê°€ ìžˆì—ˆë‹¤.

### BTN ê¸°ëŠ¥ ì¶”ê°€ë¥¼ ìœ„í•œ SW Stack

![BTN ê¸°ëŠ¥ SW Stack](https://raw.githubusercontent.com/goeun-oh/ARM/main/0619/0.GPIO_BTN_%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0.mdimage-1.png)

### ap_main ê³„ì¸µ ì¶”ê°€

`ap_main`ì„ ë§Œë“¤ì–´ì„œ SW Stack Layerë¥¼ í•˜ë‚˜ ë” ì¶”ê°€í•œë‹¤.

`main.c`ì˜ ê¸°ëŠ¥:
- `system` ì´ˆê¸°í™”
- `application` ì‹¤í–‰ ê¸°ëŠ¥ ì™¸ì—ëŠ” ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤

## ðŸ”˜ ë²„íŠ¼ í•˜ë“œì›¨ì–´ ì´í•´

### BTN(Push Switch, Tact Switch) ë¶„ì„

Schematicìœ¼ë¡œ ìš°ë¦¬ê°€ ê°€ì§„ BTNì´ HWì ìœ¼ë¡œ ì–´ë–¤ í˜•íƒœì¸ì§€ ì•Œ ìˆ˜ ìžˆë‹¤.

![ë²„íŠ¼ íšŒë¡œë„](https://raw.githubusercontent.com/goeun-oh/ARM/main/0619/0.GPIO_BTN_%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0.mdimage.png)

BTNì´ Pullup ë˜ì–´ìžˆë‹¤:
- BTNì´ ëˆŒë¦¬ì§€ ì•Šì€ ìƒíƒœ: `3.3V` (HIGH)
- BTNì´ ëˆŒë¦° ìƒíƒœ: `0V` (LOW)

### Chattering(Bounce) í˜„ìƒ

ì´ìƒì ìœ¼ë¡œ 0 ë˜ëŠ” 1ë¡œ ë³€í™”í•˜ë©´ ì™„ë²½í•˜ì§€ë§Œ ë…¸ì´ì¦ˆê°€ ê»´ì„œ Chattering(Bounce) í˜„ìƒì´ ë°œìƒí•œë‹¤.

![Chattering í˜„ìƒ](https://raw.githubusercontent.com/goeun-oh/ARM/main/0619/0.GPIO_BTN_%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0.md%7B7AD34572-2C74-4F83-A793-2E73188AF847%7D.png)

ì´ëŸ¬í•œ Noise ë˜í•œ ê³ ë ¤í•˜ë©´ì„œ ì½”ë“œë¥¼ ì§œì•¼í•œë‹¤. (debounce ì½”ë“œë¥¼ ìž‘ì„±í•´ì•¼í•œë‹¤)

## ðŸ” ë²„íŠ¼ ìƒíƒœ ê°ì§€ êµ¬í˜„

### ë²„íŠ¼ ìƒíƒœ ì •ì˜

**BTNì˜ ìƒíƒœ:**
1. Button Normal ìƒíƒœ: RELEASED(`1`) ìƒíƒœ
2. Button Push: PUSHED(`0`) ìƒíƒœ

### GPIO READ í•¨ìˆ˜ êµ¬í˜„

ë²„íŠ¼ì˜ ìƒíƒœë¥¼ ë°›ê³  ì‹¶ë‹¤. `Button_GetState()`: ë²„íŠ¼ì˜ ìƒíƒœë¥¼ ë°›ì•„ì˜¤ëŠ” í•¨ìˆ˜

```c
uint32_t GPIO_ReadPin(GPIO_TypeDef *GPIOx, uint32_t pinNum){
    return ((GPIOx -> IDR & (1U << pinNum))? 1:0); //0ì´ë©´ 0ì´ë‚˜ê°€ê³ , 0ì´ ì•„ë‹Œ ê°’ì´ë©´ 1ì´ë‚˜ê°„ë‹¤
}
```

### Button Get State í•¨ìˆ˜

```c
button_state_t Button_GetState(){
 static uint32_t prevState = RELEASED; //ì „ì›ì„ ì²˜ìŒì— ë„£ìœ¼ë©´ ì´ˆê¸°ê°’ì´ HIGH
 uint32_t curState;
 curState= GPIO_ReadPin(GPIOC, 13);

 //ì²˜ìŒ ëˆ„ë¥¸ ê²½ìš°
 if ((prevState == RELEASED) && (curState == PUSHED)){
  prevState = PUSHED;
  return ACT_PUSHED;
 } else if ((prevState == PUSHED) &&(curState == RELEASE)){
  prevState = RELEASED;
  return ACT_RELEASED;
 }
 return NO_ACT;
}
```

**static ë³€ìˆ˜ ì‚¬ìš© ì´ìœ :**
- Scopeë¥¼ ë²—ì–´ë‚˜ë„ ë©”ëª¨ë¦¬ ê³µê°„ì´ ë°˜í™˜ë˜ì§€ ì•ŠëŠ”ë‹¤
- ë©”ëª¨ë¦¬ ìž¬í• ë‹¹ì„ ì•ˆí•˜ë‹ˆ ì´ì „ ê°’ì´ ê³„ì† ìœ ì§€ëœë‹¤

## ðŸ’» Cì–¸ì–´ì˜ í•œê³„

### Edge Detectì˜ í•œê³„

- Cì–¸ì–´ ì½”ë“œë§Œìœ¼ë¡œëŠ” edge detect í•˜ëŠ”ê²Œ ì—†ë‹¤
- Cì–¸ì–´ë¡œ CLK edge ë™ê¸°í™”ë¥¼ í•  ìˆ˜ ì—†ë‹¤

ì´ëŸ¬í•œ í•œê³„ ë•Œë¬¸ì— ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•´ì•¼ í•œë‹¤.

## ðŸ“‹ ì •ë¦¬

ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” SW Stackê³¼ ëª¨ë“ˆí™”ì˜ ì¤‘ìš”ì„±ì„ ë‹¤ë¤˜ë‹¤:

1. **í´ë” ë¶„ë¦¬**: GPIO ê´€ë ¨ ê¸°ëŠ¥ì„ ë³„ë„ë¡œ ë¶„ë¦¬
2. **SW Stack**: ê³„ì¸µì  êµ¬ì¡°ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ê³„
3. **ì˜¬ë°”ë¥¸ ì ‘ê·¼**: ì¸ì ‘í•œ Layerë¥¼ í†µí•œ í†µì‹ 
4. **ì‹¤ì œ ì ìš©**: ë²„íŠ¼ ê¸°ëŠ¥ ì¶”ê°€ ì‚¬ë¡€
5. **í•˜ë“œì›¨ì–´ ì´í•´**: Chattering í˜„ìƒê³¼ ëŒ€ì‘

**í•µì‹¬ ì›ì¹™:**
- Applicationì—ì„œ Interfaceë¡œ ì§ì ‘ ì ‘ê·¼ ê¸ˆì§€
- ì¸ì ‘í•œ ê³„ì¸µì„ í†µí•œ í†µì‹ 
- ìž¬ì‚¬ìš©ì„±ì„ ê³ ë ¤í•œ ëª¨ë“ˆí™”
- í•˜ë“œì›¨ì–´ íŠ¹ì„±ì„ ê³ ë ¤í•œ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ê³„

ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” STM32CubeIDEë¥¼ í™œìš©í•œ ê³ ê¸‰ ì´ˆê¸°í™˜ê²½ ì„¤ì •ì„ ì•Œì•„ë³´ê² ë‹¤.

---

**ì´ì „ í¬ìŠ¤íŠ¸**: [5-4. ì½”ë“œ ê°œì„  ê³¼ì • - ì‹¤ì œ í”„ë¡œì íŠ¸ ì ìš©](/posts/cortex-m-code-improvement-project)  
**ë‹¤ìŒ í¬ìŠ¤íŠ¸**: [7. ê³ ê¸‰ ì´ˆê¸°í™˜ê²½ ì„¤ì •](/posts/cortex-m-advanced-setup)
